-- MySQL dump 10.13  Distrib 8.4.6, for macos14.7 (x86_64)
--
-- Host: localhost    Database: pizza_db
-- ------------------------------------------------------
-- Server version	9.4.0

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `CUSTOMER`
--

DROP TABLE IF EXISTS `CUSTOMER`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `CUSTOMER` (
  `CUSTOMER_ID` int NOT NULL AUTO_INCREMENT,
  `FIRST_NAME` varchar(100) DEFAULT NULL,
  `LAST_NAME` varchar(100) DEFAULT NULL,
  `BIRTH_DATE` date DEFAULT NULL,
  `ADDRESS` varchar(100) DEFAULT NULL,
  `PHONE_NUMBER` varchar(20) DEFAULT NULL,
  `PIZZA_COUNT` int DEFAULT NULL,
  PRIMARY KEY (`CUSTOMER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `CUSTOMER`
--

LOCK TABLES `CUSTOMER` WRITE;
/*!40000 ALTER TABLE `CUSTOMER` DISABLE KEYS */;
/*!40000 ALTER TABLE `CUSTOMER` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `DELIVERY_PERSON`
--

DROP TABLE IF EXISTS `DELIVERY_PERSON`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `DELIVERY_PERSON` (
  `DELIVERY_PERSON_ID` int NOT NULL AUTO_INCREMENT,
  `FIRST_NAME` varchar(100) DEFAULT NULL,
  `LAST_NAME` varchar(100) DEFAULT NULL,
  `IS_AVAILABLE` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`DELIVERY_PERSON_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `DELIVERY_PERSON`
--

LOCK TABLES `DELIVERY_PERSON` WRITE;
/*!40000 ALTER TABLE `DELIVERY_PERSON` DISABLE KEYS */;
/*!40000 ALTER TABLE `DELIVERY_PERSON` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `DISCOUNT_CODE`
--

DROP TABLE IF EXISTS `DISCOUNT_CODE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `DISCOUNT_CODE` (
  `DISCOUNT_CODE_ID` int NOT NULL AUTO_INCREMENT,
  `CODE` varchar(30) NOT NULL,
  `DISCOUNT_PERCENT` decimal(5,2) NOT NULL,
  `IS_USED` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`DISCOUNT_CODE_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `DISCOUNT_CODE`
--

LOCK TABLES `DISCOUNT_CODE` WRITE;
/*!40000 ALTER TABLE `DISCOUNT_CODE` DISABLE KEYS */;
/*!40000 ALTER TABLE `DISCOUNT_CODE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `INGREDIENT`
--

DROP TABLE IF EXISTS `INGREDIENT`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `INGREDIENT` (
  `INGREDIENT_ID` int NOT NULL AUTO_INCREMENT,
  `INGREDIENT_NAME` varchar(100) DEFAULT NULL,
  `COST` decimal(6,2) DEFAULT NULL,
  `IS_VEGAN_SAFE` tinyint(1) DEFAULT NULL,
  `IS_VEGETARIAN_SAFE` tinyint(1) DEFAULT NULL,
  `IS_ALCOHOL` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`INGREDIENT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `INGREDIENT`
--

LOCK TABLES `INGREDIENT` WRITE;
/*!40000 ALTER TABLE `INGREDIENT` DISABLE KEYS */;
/*!40000 ALTER TABLE `INGREDIENT` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ORDER_ITEM`
--

DROP TABLE IF EXISTS `ORDER_ITEM`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `ORDER_ITEM` (
  `ORDER_ITEM_ID` int NOT NULL AUTO_INCREMENT,
  `AMOUNT` int NOT NULL,
  `PRODUCT_ID` int NOT NULL,
  `ORDER_ID` int NOT NULL,
  PRIMARY KEY (`ORDER_ITEM_ID`),
  KEY `PRODUCT_ID` (`PRODUCT_ID`),
  KEY `ORDER_ID` (`ORDER_ID`),
  CONSTRAINT `order_item_ibfk_1` FOREIGN KEY (`PRODUCT_ID`) REFERENCES `PRODUCT` (`PRODUCT_ID`),
  CONSTRAINT `order_item_ibfk_2` FOREIGN KEY (`ORDER_ID`) REFERENCES `ORDERS` (`ORDER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ORDER_ITEM`
--

LOCK TABLES `ORDER_ITEM` WRITE;
/*!40000 ALTER TABLE `ORDER_ITEM` DISABLE KEYS */;
/*!40000 ALTER TABLE `ORDER_ITEM` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ORDERS`
--

DROP TABLE IF EXISTS `ORDERS`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `ORDERS` (
  `ORDER_ID` int NOT NULL AUTO_INCREMENT,
  `CREATED_AT` datetime DEFAULT NULL,
  `DELIVERED_AT` datetime DEFAULT NULL,
  `TOTAL_PRICE` decimal(8,2) DEFAULT NULL,
  `DISCOUNT_CODE_ID` int DEFAULT NULL,
  `DELIVERY_PERSON_ID` int NOT NULL,
  `STATUS_ID` int NOT NULL,
  `CUSTOMER_ID` int NOT NULL,
  PRIMARY KEY (`ORDER_ID`),
  KEY `DISCOUNT_CODE_ID` (`DISCOUNT_CODE_ID`),
  KEY `DELIVERY_PERSON_ID` (`DELIVERY_PERSON_ID`),
  KEY `STATUS_ID` (`STATUS_ID`),
  KEY `CUSTOMER_ID` (`CUSTOMER_ID`),
  CONSTRAINT `orders_ibfk_1` FOREIGN KEY (`DISCOUNT_CODE_ID`) REFERENCES `DISCOUNT_CODE` (`DISCOUNT_CODE_ID`),
  CONSTRAINT `orders_ibfk_2` FOREIGN KEY (`DELIVERY_PERSON_ID`) REFERENCES `DELIVERY_PERSON` (`DELIVERY_PERSON_ID`),
  CONSTRAINT `orders_ibfk_3` FOREIGN KEY (`STATUS_ID`) REFERENCES `STATUS` (`STATUS_ID`),
  CONSTRAINT `orders_ibfk_4` FOREIGN KEY (`CUSTOMER_ID`) REFERENCES `CUSTOMER` (`CUSTOMER_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ORDERS`
--

LOCK TABLES `ORDERS` WRITE;
/*!40000 ALTER TABLE `ORDERS` DISABLE KEYS */;
/*!40000 ALTER TABLE `ORDERS` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `PRODUCT`
--

DROP TABLE IF EXISTS `PRODUCT`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `PRODUCT` (
  `PRODUCT_ID` int NOT NULL AUTO_INCREMENT,
  `PRODUCT_NAME` varchar(100) NOT NULL,
  `IS_VEGAN` tinyint(1) DEFAULT NULL,
  `IS_VEGETARIAN` tinyint(1) DEFAULT NULL,
  `COST` decimal(6,2) DEFAULT NULL,
  `PRODUCT_TYPE_ID` int NOT NULL,
  PRIMARY KEY (`PRODUCT_ID`),
  KEY `PRODUCT_TYPE_ID` (`PRODUCT_TYPE_ID`),
  CONSTRAINT `product_ibfk_1` FOREIGN KEY (`PRODUCT_TYPE_ID`) REFERENCES `PRODUCT_TYPE` (`PRODUCT_TYPE_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `PRODUCT`
--

LOCK TABLES `PRODUCT` WRITE;
/*!40000 ALTER TABLE `PRODUCT` DISABLE KEYS */;
/*!40000 ALTER TABLE `PRODUCT` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `PRODUCT_INGREDIENT`
--

DROP TABLE IF EXISTS `PRODUCT_INGREDIENT`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `PRODUCT_INGREDIENT` (
  `INGREDIENT_ID` int NOT NULL,
  `PRODUCT_ID` int NOT NULL,
  `NUMBER_OF_INGREDIENTS` int DEFAULT NULL,
  PRIMARY KEY (`INGREDIENT_ID`,`PRODUCT_ID`),
  KEY `PRODUCT_ID` (`PRODUCT_ID`),
  CONSTRAINT `product_ingredient_ibfk_1` FOREIGN KEY (`INGREDIENT_ID`) REFERENCES `INGREDIENT` (`INGREDIENT_ID`),
  CONSTRAINT `product_ingredient_ibfk_2` FOREIGN KEY (`PRODUCT_ID`) REFERENCES `PRODUCT` (`PRODUCT_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `PRODUCT_INGREDIENT`
--

LOCK TABLES `PRODUCT_INGREDIENT` WRITE;
/*!40000 ALTER TABLE `PRODUCT_INGREDIENT` DISABLE KEYS */;
/*!40000 ALTER TABLE `PRODUCT_INGREDIENT` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `PRODUCT_TYPE`
--

DROP TABLE IF EXISTS `PRODUCT_TYPE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `PRODUCT_TYPE` (
  `PRODUCT_TYPE_ID` int NOT NULL AUTO_INCREMENT,
  `PRODUCT_TYPE_NAME` varchar(100) NOT NULL,
  `MARGIN` int DEFAULT NULL,
  `VAT` int DEFAULT NULL,
  PRIMARY KEY (`PRODUCT_TYPE_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `PRODUCT_TYPE`
--

LOCK TABLES `PRODUCT_TYPE` WRITE;
/*!40000 ALTER TABLE `PRODUCT_TYPE` DISABLE KEYS */;
/*!40000 ALTER TABLE `PRODUCT_TYPE` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `STATUS`
--

DROP TABLE IF EXISTS `STATUS`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `STATUS` (
  `STATUS_ID` int NOT NULL AUTO_INCREMENT,
  `STATUS_NAME` varchar(100) NOT NULL,
  PRIMARY KEY (`STATUS_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;


CREATE TABLE IF NOT EXISTS DELIVERY_PERSON_POSTAL (
  DELIVERY_PERSON_ID INT NOT NULL,            
  POSTAL_CODE_PREFIX VARCHAR(10) NOT NULL,    
  PRIMARY KEY (DELIVERY_PERSON_ID, POSTAL_CODE_PREFIX),  
  CONSTRAINT fk_dpp_person
    FOREIGN KEY (DELIVERY_PERSON_ID)
    REFERENCES DELIVERY_PERSON(DELIVERY_PERSON_ID)
    ON DELETE CASCADE
) ENGINE=InnoDB;

--
-- Dumping data for table `STATUS`
--

LOCK TABLES `STATUS` WRITE;
/*!40000 ALTER TABLE `STATUS` DISABLE KEYS */;
/*!40000 ALTER TABLE `STATUS` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
ALTER TABLE DISCOUNT_CODE
  ADD CONSTRAINT uq_discount_code UNIQUE (CODE),
  ADD CONSTRAINT chk_discount_percent CHECK (DISCOUNT_PERCENT BETWEEN 0 AND 100);

ALTER TABLE INGREDIENT
  ADD CONSTRAINT chk_ingredient_cost CHECK (COST >= 0);

ALTER TABLE ORDER_ITEM
  ADD CONSTRAINT chk_order_item_amount CHECK (AMOUNT > 0);

ALTER TABLE PRODUCT
  ADD CONSTRAINT chk_product_cost CHECK (COST >= 0);

ALTER TABLE PRODUCT_TYPE
  ADD CONSTRAINT chk_margin CHECK (MARGIN >= 0),
  ADD CONSTRAINT chk_vat CHECK (VAT >= 0);

ALTER TABLE STATUS
  ADD CONSTRAINT uq_status_name UNIQUE (STATUS_NAME);




 INSERT INTO INGREDIENT
     (INGREDIENT_ID, INGREDIENT_NAME, COST, IS_VEGAN_SAFE,  IS_VEGETARIAN_SAFE , IS_ALCOHOL)
     VALUES
     (1,  'Tomato sauce',       30,  1, 1, 0),
    (2,  'Mozzarella',         80,  0, 1, 0),
     (3,  'Vegan mozzarella',   90,  1, 1, 0),
     (4,  'Basil',              10,  1, 1, 0),
     (5,  'Mushrooms',          50,  1, 1, 0),
     (6,  'Pepperoni',         120,  0, 0, 0),
      (7,  'Ham',               110,  0, 0, 0),
      (8,  'Olives',             40,  1, 1, 0),
    (9,  'Onion',              20,  1, 1, 0),
      (10, 'Bell pepper',        40,  1, 1, 0);


      INSERT INTO CUSTOMER
  (FIRST_NAME, LAST_NAME, BIRTH_DATE, ADDRESS, PHONE_NUMBER, PIZZA_COUNT)
VALUES
  ('Anna',     'Ivanova',   '1999-03-14', 'Keizersgracht 12, Amsterdam',   '+31611110001', 3),
  ('Boris',    'Petrov',    '1997-11-02', 'Prinsengracht 45, Amsterdam',   '+31611110002', 12),
  ('Chen',     'Li',        '2001-06-28', 'Herengracht 77, Amsterdam',     '+31611110003', 7),
  ('Daria',    'Smirnova',  '2000-12-09', 'Singel 5, Amsterdam',           '+31611110004', 0),
  ('Elias',    'Cohen',     '1995-04-21', 'Damrak 101, Amsterdam',         '+31611110005', 18),
  ('Fatima',   'Noor',      '1998-09-30', 'Spuistraat 220, Amsterdam',     '+31611110006', 5),
  ('Giorgio',  'Rossi',     '1996-02-15', 'Vijzelstraat 3, Amsterdam',     '+31611110007', 10),
  ('Hanna',    'Mueller',   '2002-07-11', 'Leidsestraat 89, Amsterdam',    '+31611110008', 1),
  ('Ivan',     'Horvat',    '1994-01-05', 'Utrechtsestraat 60, Amsterdam', '+31611110009', 23),
  ('Julia',    'Novak',     '2003-05-19', 'Ceintuurbaan 140, Amsterdam',   '+31611110010', 9);



INSERT INTO DELIVERY_PERSON (FIRST_NAME, LAST_NAME, IS_AVAILABLE) VALUES
('Max',   'de Vries', 1),
('Sofie', 'Janssen',  1),
('Lars',  'Bakker',   1);

SELECT DELIVERY_PERSON_ID INTO @max_id
FROM DELIVERY_PERSON
WHERE FIRST_NAME='Max' AND LAST_NAME='de Vries' LIMIT 1;

SELECT DELIVERY_PERSON_ID INTO @sofie_id
FROM DELIVERY_PERSON
WHERE FIRST_NAME='Sofie' AND LAST_NAME='Janssen' LIMIT 1;

SELECT DELIVERY_PERSON_ID INTO @lars_id
FROM DELIVERY_PERSON
WHERE FIRST_NAME='Lars' AND LAST_NAME='Bakker' LIMIT 1;

CREATE TABLE IF NOT EXISTS DELIVERY_PERSON_POSTAL (
  DELIVERY_PERSON_ID INT NOT NULL,
  POSTAL_CODE_PREFIX VARCHAR(10) NOT NULL,
  PRIMARY KEY (DELIVERY_PERSON_ID, POSTAL_CODE_PREFIX),
  CONSTRAINT fk_dpp_person
    FOREIGN KEY (DELIVERY_PERSON_ID) REFERENCES DELIVERY_PERSON(DELIVERY_PERSON_ID)
    ON DELETE CASCADE
) ENGINE=InnoDB;

INSERT INTO DELIVERY_PERSON_POSTAL (DELIVERY_PERSON_ID, POSTAL_CODE_PREFIX) VALUES
(@max_id,  '1011'),
(@max_id,  '1012'),
(@sofie_id,'1013'),
(@sofie_id,'1014'),
(@lars_id, '1015'),
(@lars_id, '1016');



INSERT INTO PRODUCT_TYPE (PRODUCT_TYPE_NAME, MARGIN, VAT)
SELECT 'Pizza', 40, 9
FROM DUAL
WHERE NOT EXISTS (
  SELECT 1 FROM PRODUCT_TYPE WHERE PRODUCT_TYPE_NAME='Pizza'
);


INSERT INTO PRODUCT_TYPE (PRODUCT_TYPE_NAME, MARGIN, VAT)
SELECT 'Drink', 0, 9
FROM DUAL
WHERE NOT EXISTS (
  SELECT 1 FROM PRODUCT_TYPE WHERE PRODUCT_TYPE_NAME='Drink'
);


INSERT INTO PRODUCT_TYPE (PRODUCT_TYPE_NAME, MARGIN, VAT)
SELECT 'Dessert', 0, 9
FROM DUAL
WHERE NOT EXISTS (
  SELECT 1 FROM PRODUCT_TYPE WHERE PRODUCT_TYPE_NAME='Dessert'
);


SELECT PRODUCT_TYPE_ID INTO @pizza_type_id
FROM PRODUCT_TYPE WHERE PRODUCT_TYPE_NAME='Pizza' LIMIT 1;
SELECT PRODUCT_TYPE_ID INTO @drink_type_id
FROM PRODUCT_TYPE WHERE PRODUCT_TYPE_NAME='Drink' LIMIT 1;

SELECT PRODUCT_TYPE_ID INTO @dessert_type_id
FROM PRODUCT_TYPE WHERE PRODUCT_TYPE_NAME='Dessert' LIMIT 1;



INSERT INTO PRODUCT (PRODUCT_NAME, IS_VEGAN, IS_VEGETARIAN, COST, PRODUCT_TYPE_ID) VALUES
('Margherita',               0, 1,  8.50,  @pizza_type_id),
('Marinara',                 1, 1,  7.50,  @pizza_type_id),
('Funghi',                   0, 1,  9.50,  @pizza_type_id),
('Pepperoni',                0, 0, 10.50,  @pizza_type_id),
('Prosciutto',               0, 0, 10.90,  @pizza_type_id),
('Veggie',                   0, 1,  9.90,  @pizza_type_id),
('Quattro Formaggi (veg)',   0, 1, 11.20,  @pizza_type_id),
('Hawaiian',                 0, 0, 10.80,  @pizza_type_id),
('Diavola',                  0, 0, 10.90,  @pizza_type_id),
('Vegan Special',            1, 1, 11.50,  @pizza_type_id);

INSERT INTO PRODUCT (PRODUCT_NAME, IS_VEGAN, IS_VEGETARIAN, COST, PRODUCT_TYPE_ID) VALUES
('Tiramisu',            0, 1, 4.50, @dessert_type_id),
('Chocolate Brownie',   0, 1, 4.00, @dessert_type_id),
('Apple Pie',           0, 1, 3.80, @dessert_type_id);


INSERT INTO PRODUCT (PRODUCT_NAME, IS_VEGAN, IS_VEGETARIAN, COST, PRODUCT_TYPE_ID) VALUES
('Coca-Cola 0.33L',        1, 1, 2.50, @drink_type_id),
('Sparkling Water 0.5L',   1, 1, 2.20, @drink_type_id),
('Apple Juice 0.33L',      1, 1, 2.60, @drink_type_id);




-- Margherita: Tomato sauce(1), Mozzarella(2), Basil(4)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Margherita';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 2, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Margherita';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 4, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Margherita';

-- Marinara: Tomato sauce(1), Onion(9), Basil(4)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Marinara';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 9, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Marinara';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 4, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Marinara';

-- Funghi: Tomato sauce(1), Mozzarella(2), Mushrooms(5)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Funghi';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 2, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Funghi';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 5, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Funghi';

-- Pepperoni: Tomato sauce(1), Mozzarella(2), Pepperoni(6)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Pepperoni';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 2, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Pepperoni';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 6, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Pepperoni';

-- Prosciutto: Tomato sauce(1), Mozzarella(2), Ham(7)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Prosciutto';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 2, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Prosciutto';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 7, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Prosciutto';

-- Veggie: Tomato sauce(1), Mozzarella(2), Bell pepper(10), Onion(9), Olives(8), Mushrooms(5)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Veggie';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 2, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Veggie';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 10, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Veggie';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 9, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Veggie';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 8, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Veggie';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 5, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Veggie';

-- Quattro Formaggi (veg): Tomato sauce(1), Vegan mozzarella(3) x2, Olives(8)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Quattro Formaggi (veg)';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 3, p.PRODUCT_ID, 2 FROM PRODUCT p WHERE p.PRODUCT_NAME='Quattro Formaggi (veg)';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 8, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Quattro Formaggi (veg)';

-- Hawaiian: Tomato sauce(1), Mozzarella(2), Ham(7), Bell pepper(10)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Hawaiian';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 2, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Hawaiian';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 7, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Hawaiian';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 10, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Hawaiian';

-- Diavola: Tomato sauce(1), Mozzarella(2), Pepperoni(6), Onion(9)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Diavola';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 2, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Diavola';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 6, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Diavola';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 9, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Diavola';

-- Vegan Special: Tomato sauce(1), Vegan mozzarella(3), Mushrooms(5) x2, Bell pepper(10)
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 1, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Vegan Special';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 3, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Vegan Special';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 5, p.PRODUCT_ID, 2 FROM PRODUCT p WHERE p.PRODUCT_NAME='Vegan Special';
INSERT INTO PRODUCT_INGREDIENT (INGREDIENT_ID, PRODUCT_ID, NUMBER_OF_INGREDIENTS)
SELECT 10, p.PRODUCT_ID, 1 FROM PRODUCT p WHERE p.PRODUCT_NAME='Vegan Special';




CREATE OR REPLACE VIEW v_product_prices AS
SELECT
    p.PRODUCT_ID,
    p.PRODUCT_NAME,
    pt.PRODUCT_TYPE_NAME,
    p.IS_VEGAN,
    p.IS_VEGETARIAN,
    ROUND(
        (COALESCE(SUM(i.COST * pi.NUMBER_OF_INGREDIENTS), 0) * (1 + pt.MARGIN/100))
        * (1 + pt.VAT/100),
        2
    ) AS FINAL_PRICE
FROM PRODUCT p
JOIN PRODUCT_TYPE pt ON pt.PRODUCT_TYPE_ID = p.PRODUCT_TYPE_ID
LEFT JOIN PRODUCT_INGREDIENT pi ON pi.PRODUCT_ID = p.PRODUCT_ID
LEFT JOIN INGREDIENT i ON i.INGREDIENT_ID = pi.INGREDIENT_ID
GROUP BY p.PRODUCT_ID, p.PRODUCT_NAME, pt.PRODUCT_TYPE_NAME, p.IS_VEGAN, p.IS_VEGETARIAN, pt.MARGIN, pt.VAT;